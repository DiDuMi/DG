---
import type { Language } from '../lib/i18n';
import LanguageToggle from './LanguageToggle.astro';
import type { SiteContent } from '../lib/siteContent';

type Props = {
  lang: Language;
  content: SiteContent;
  hrefCn: string;
  hrefEn: string;
};

const { lang, content, hrefCn, hrefEn } = Astro.props;
const menuLabel = lang === 'cn' ? '菜单' : 'Menu';
---

<header class="site-header">
  <div class="container site-header__inner">
    <a href={lang === 'cn' ? '/cn/' : '/en/'} class="brand">
      <span class="brand__name">{content.siteName}</span>
      <span class="brand__tagline muted">{content.tagline}</span>
    </a>

    <nav class="desktop-nav" aria-label="Primary">
      <a href={lang === 'cn' ? '/cn/' : '/en/'} class="nav-link">{content.nav.home}</a>
      <a href={lang === 'cn' ? '/cn/about/' : '/en/about/'} class="nav-link">{content.nav.about}</a>
      <a href={lang === 'cn' ? '/cn/products/' : '/en/products/'} class="nav-link">{content.nav.products}</a>
      <a href={lang === 'cn' ? '/cn/applications/' : '/en/applications/'} class="nav-link">{content.nav.applications}</a>
      <a href={lang === 'cn' ? '/cn/certifications/' : '/en/certifications/'} class="nav-link">{content.nav.certifications}</a>
      <a href={lang === 'cn' ? '/cn/contact/' : '/en/contact/'} class="nav-link nav-link--accent">{content.nav.contact}</a>
      <LanguageToggle current={lang} hrefCn={hrefCn} hrefEn={hrefEn} />
    </nav>

    <details class="mobile-nav" id="mobile-nav">
      <summary class="btn mobile-toggle" aria-label={menuLabel}>{menuLabel}</summary>
      <div class="panel mobile-panel" aria-label="Mobile navigation">
        <div class="mobile-links">
          <a href={lang === 'cn' ? '/cn/' : '/en/'} class="mobile-link">{content.nav.home}</a>
          <a href={lang === 'cn' ? '/cn/about/' : '/en/about/'} class="mobile-link">{content.nav.about}</a>
          <a href={lang === 'cn' ? '/cn/products/' : '/en/products/'} class="mobile-link">{content.nav.products}</a>
          <a href={lang === 'cn' ? '/cn/applications/' : '/en/applications/'} class="mobile-link">{content.nav.applications}</a>
          <a href={lang === 'cn' ? '/cn/certifications/' : '/en/certifications/'} class="mobile-link">{content.nav.certifications}</a>
          <a href={lang === 'cn' ? '/cn/contact/' : '/en/contact/'} class="mobile-link mobile-link--accent">{content.nav.contact}</a>
        </div>
        <div class="mobile-lang">
          <LanguageToggle current={lang} hrefCn={hrefCn} hrefEn={hrefEn} />
        </div>
      </div>
    </details>
  </div>
</header>

<script>
  (() => {
    const root = document.getElementById('mobile-nav');
    if (!(root instanceof HTMLDetailsElement)) return;
    root.addEventListener('click', (e) => {
      const target = e.target;
      if (!(target instanceof HTMLElement)) return;
      if (target.closest('a')) root.open = false;
    });
  })();
</script>
